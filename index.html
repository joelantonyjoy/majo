<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="application-name" content="Majo - 6 word puzzle" />
    <meta
      property="description"
      content="Guess the hidden word in 6 tries. Unlimited puzzle words to test your skills."
    />
    <meta property="og:title" content="Majo - 6 word puzzle" />
    <meta
      property="og:url"
      content="https://gallant-heisenberg-9705f5.netlify.app/"
    />
    <meta
      property="og:description"
      content="Guess the hidden word in 6 tries. Unlimited puzzle words to test your skills."
    />
    <meta property="og:image" content="logo.svg" />
    <link rel="icon" href="logo.svg" type="image/x-icon" />
    <title>MAJO</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="instruction_container">
      <header>
        <h1>HOW TO PLAY</h1>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          height="24"
          viewBox="0 0 24 24"
          width="24"
        >
          <path
            fill="var(--color-tone-1)"
            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
          ></path>
        </svg>
      </header>
      <section>
        <div class="instructions">
          <p>Guess the <strong>MAJO WORD</strong> in six tries.</p>
          <p>
            Each guess must be a valid five-letter word. Hit the enter button to
            submit.
          </p>
          <p>
            After each guess, the color of the tiles will change to show how
            close your guess was to the word.
          </p>
          <div class="examples">
            <p><strong>Examples</strong></p>
            <div class="example">
              <div class="row">
                <div class="input_column correct">T</div>
                <div class="input_column">E</div>
                <div class="input_column">A</div>
                <div class="input_column">R</div>
                <div class="input_column">S</div>
              </div>
              <p>
                The letter <strong>T</strong> is in the word and in the correct
                spot.
              </p>
            </div>
            <div class="example">
              <div class="row">
                <div class="input_column">P</div>
                <div class="input_column wrong-position">E</div>
                <div class="input_column">A</div>
                <div class="input_column">C</div>
                <div class="input_column">E</div>
              </div>
              <p>
                The letter <strong>E</strong> is in the word but in the wrong
                spot.
              </p>
            </div>
            <div class="example">
              <div class="row">
                <div class="input_column">A</div>
                <div class="input_column">P</div>
                <div class="input_column">P</div>
                <div class="input_column incorrect">L</div>
                <div class="input_column">Y</div>
              </div>
              <p>
                The letter <strong>R</strong> is not in the word in any spot.
              </p>
            </div>
          </div>
          <p>
            <strong>Unlimited words each day!</strong>
          </p>
        </div>
      </section>
    </div>
    <header class="navbar">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        height="24"
        viewBox="0 0 24 24"
        width="24"
      >
        <path
          fill="var(--color-tone-1)"
          d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"
        ></path>
      </svg>
      MAJO
    </header>
    <main>
      <div class="game_container">
        <div class="row">
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
        </div>
        <div class="row">
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
        </div>
        <div class="row">
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
        </div>
        <div class="row">
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
        </div>
        <div class="row">
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
        </div>
        <div class="row">
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
          <div class="input_column"></div>
        </div>
      </div>
      <div class="keyboard_container">
        <div class="row">
          <div class="keyboard-key" data-key="Q">Q</div>
          <div class="keyboard-key" data-key="W">W</div>
          <div class="keyboard-key" data-key="E">E</div>
          <div class="keyboard-key" data-key="R">R</div>
          <div class="keyboard-key" data-key="T">T</div>
          <div class="keyboard-key" data-key="Y">Y</div>
          <div class="keyboard-key" data-key="U">U</div>
          <div class="keyboard-key" data-key="I">I</div>
          <div class="keyboard-key" data-key="O">O</div>
          <div class="keyboard-key" data-key="P">P</div>
        </div>
        <div class="row">
          <div class="keyboard-key" data-key="A">A</div>
          <div class="keyboard-key" data-key="S">S</div>
          <div class="keyboard-key" data-key="D">D</div>
          <div class="keyboard-key" data-key="F">F</div>
          <div class="keyboard-key" data-key="G">G</div>
          <div class="keyboard-key" data-key="H">H</div>
          <div class="keyboard-key" data-key="J">J</div>
          <div class="keyboard-key" data-key="K">K</div>
          <div class="keyboard-key" data-key="L">L</div>
        </div>
        <div class="row">
          <div class="keyboard-key" data-key="ENTER">ENTER</div>
          <div class="keyboard-key" data-key="Z">Z</div>
          <div class="keyboard-key" data-key="X">X</div>
          <div class="keyboard-key" data-key="C">C</div>
          <div class="keyboard-key" data-key="V">V</div>
          <div class="keyboard-key" data-key="B">B</div>
          <div class="keyboard-key" data-key="N">N</div>
          <div class="keyboard-key" data-key="M">M</div>
          <div class="keyboard-key" data-key="CLEAR">CLEAR</div>
        </div>
      </div>
    </main>
    <script src="constants.js"></script>
    <script>
      let helpButton = document.querySelector(".navbar svg");
      let helpModalButton = document.querySelector(
        ".instruction_container svg"
      );
      let helpModal = document.querySelector(".instruction_container");
      let rows = [...document.querySelectorAll(".game_container .row")];
      let keyboardKeys = [...document.querySelectorAll(".keyboard-key")];
      let keyMaps = new Map();
      let size,
        answerIndex,
        correctAnswer,
        hasGuessed,
        currentAttempt,
        currentWord;

      function toggleHelp() {
        helpModal.classList.toggle("slideIn");
      }

      helpButton.addEventListener("click", toggleHelp);
      helpModalButton.addEventListener("click", toggleHelp);

      function startInputing() {
        document.addEventListener("keydown", handleKeyPress);

        keyboardKeys.forEach((key) =>
          key.addEventListener("click", handleKeyClick)
        );
      }

      function stopInputing() {
        document.removeEventListener("keydown", handleKeyPress);

        keyboardKeys.forEach((key) =>
          key.removeEventListener("click", handleKeyClick)
        );
      }

      function checkCorrectPosition(element, ans, guess, index) {
        let foundIndex = ans.indexOf(element);
        return (
          (element === ans[foundIndex] && index === foundIndex) ||
          ans.lastIndexOf(element) == index
        );
      }

      function getStatistics(guess, ans) {
        let arr = Array(5).fill(STATUS.NOT_YET_FOUND);
        ans.split("").forEach((char, index) => {
          if (guess[index] == char) {
            arr[index] = STATUS.CORRECT_POSITION;
          } else {
            for (let i = 0; i < 5; i++) {
              if (arr[i] == STATUS.NOT_YET_FOUND) {
                if (char == guess[i]) {
                  arr[i] = STATUS.WRONG_POSITION;
                  break;
                }
              }
            }
          }
        });
        arr.forEach((ele, index) => {
          if (ele == STATUS.NOT_YET_FOUND) {
            arr[index] = STATUS.NOT_IN_THE_WORD;
          }
        });
        return arr;
      }

      function updateRowWithStats(stats) {
        let columns = rows[currentAttempt].querySelectorAll(".input_column");
        columns.forEach((element, index) => {
          element.classList.add(COLOR[stats[index]]);
        });
      }

      function updateKeyBoardWithStats(stats) {
        stats.forEach((stat, index) => {
          let currentKeyStatus = keyMaps.get(currentWord[index]);
          if (
            currentKeyStatus == STATUS.CORRECT_POSITION ||
            (currentKeyStatus == STATUS.WRONG_POSITION &&
              stat == STATUS.NOT_IN_THE_WORD)
          )
            return;
          keyMaps.set(currentWord[index], stat);
        });
        updateKeyBoardColor();
      }

      function updateKeyBoardColor() {
        keyMaps.forEach((v, k) => {
          let element = document.querySelector("[data-key='" + k + "']");
          if (COLOR[v]) element.classList.add(COLOR[v]);
        });
      }

      function updateRow() {
        let columns = rows[currentAttempt].querySelectorAll(".input_column");
        columns.forEach((element, index) => {
          if (currentWord[index]) {
            element.innerHTML = currentWord[index];
          } else {
            element.innerHTML = "";
          }
        });
      }

      function isValidWord(currentWordString) {
        return dictionary.indexOf(currentWordString) === -1 ? false : true;
      }

      function vibrateWords() {
        let columns = rows[currentAttempt].querySelectorAll(".input_column");
        columns.forEach((el) => {
          el.classList.add("shake");
          setTimeout(() => {
            el.classList.remove("shake");
          }, 200);
        });
      }

      function handleEnterKeyPress() {
        let currentWordString = currentWord.join("").toLowerCase();
        if (currentWord.length != 5) return;
        if (!isValidWord(currentWordString)) {
          vibrateWords();
          return;
        }
        let stats;
        if (currentWordString === correctAnswer) {
          hasGuessed = true;
          stopInputing();
          stats = Array(5).fill(STATUS.CORRECT_POSITION);
        } else {
          stats = getStatistics(currentWordString, correctAnswer);
        }
        updateRowWithStats(stats);
        updateKeyBoardWithStats(stats);
        currentWord = [];
        currentAttempt = currentAttempt + 1;
        if (hasGuessed || (!hasGuessed && currentAttempt > 5)) {
          if (hasGuessed) {
            alert(
              "You got it : " +
                correctAnswer +
                "\nStarting a new game right away :)"
            );
          } else {
            stopInputing();
            alert(
              "You've exhausted your attempts. The word was : " +
                correctAnswer +
                "\nStarting a new game right away :)"
            );
          }
          reset();
          startNewGame();
        }
      }

      function handleKeyPress(e) {
        if (hasGuessed) {
          console.log("Winner");
          return;
        }
        if (currentAttempt > 5) {
          console.log("GameOver");
          return;
        }
        let keyCode = e.keyCode;
        // if (keyCode == 13 || keyCode == 8 || (keyCode >= 65 && keyCode <= 90)) {
        //   console.log(keyCode);
        // }
        if (keyCode >= 65 && keyCode <= 90) {
          if (currentWord.length < 5)
            currentWord.push(String.fromCharCode(keyCode));
          updateRow();
        }

        if (keyCode == 8) {
          currentWord.pop();
          updateRow();
        }

        if (keyCode == 13) {
          handleEnterKeyPress();
        }

        //65-90 is alphabtets
        //32 is space
        //8 is backspace
        //13 is enter
      }

      function handleKeyClick(e) {
        let keyCode;
        let textValue = e.target.textContent;
        if (textValue === "ENTER") {
          keyCode = 13;
        } else if (textValue === "CLEAR") {
          keyCode = 8;
        } else {
          keyCode = textValue.charCodeAt(0);
        }
        let pseudoEvent = { keyCode };
        handleKeyPress(pseudoEvent);
      }

      function reset() {
        for (let i = 65; i <= 90; i++) {
          keyMaps.set(String.fromCharCode(i), STATUS.NOT_YET_FOUND);
        }

        rows.forEach((row) => {
          let columns = [...row.children];
          columns.forEach((column) => {
            column.innerHTML = "";
            column.classList.remove(
              ...["correct", "incorrect", "wrong-position"]
            );
          });
        });

        keyboardKeys.forEach((key) => {
          key.classList.remove(...["correct", "incorrect", "wrong-position"]);
        });
      }

      function startNewGame() {
        for (let i = 65; i <= 90; i++) {
          keyMaps.set(String.fromCharCode(i), STATUS.NOT_YET_FOUND);
        }
        size = dictionary.length;
        answerIndex = Math.round(Math.random() * size);
        correctAnswer = dictionary[answerIndex];
        console.log(correctAnswer);
        hasGuessed = false;
        currentAttempt = 0;
        currentWord = [];
        startInputing();
      }

      startNewGame();
    </script>
  </body>
</html>
